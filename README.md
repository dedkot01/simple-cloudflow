## Cервис обработки поступающих данных о подписках

Разработать Cloudflow пайплайн, состоящий из 4х стримлетов:

1. "Первый" стримлет отвечает за проверку качества входящих файлов (Akka)
2. "Второй" стримлет отвечает за проверку качества данных (Akka)
3. "Третий" стримлет отвечает за накопление и агрегацию данных (Flink)
4. "Четвертый" стримлет отвечает за запись в хранилище (Spark)

Файл и структура.

На вход поступает файл с расширением .csv. 
Маска файла: ABC_1234_12345_01012021.csv, где
ABC - код продукта, 
1234 - код клиента, 
12345 - код пользователя, 
01012021 - дата формирования файла.

Структура файла:
```
№№, StartDate, EndDate, Duration, Price
1, 01.01.2021, 01.01.2021, 365, 300
2, 01.01.2021, 01.01.2021, 182, 150
3, 01.01.2021, 01.01.2021, 0, 0
```
, где 

№ - порядковый номер,

StartDate - дата начала подписки на продукт,

EndDate - дата окончания подписки на продукт,

Duration - продолжительность подписки в днях,

Price - Стоимость подписки за указанный период.

1й стримлет определяет:
- валидный ли файл пришел, т.е. маска файла соответствует требованиям, в т.ч. дата формирования файла не больше текущей даты,
- валидна ли структура файла,
если условия выполняются, то парсит файл и отправляет каждую строку в следующий стримлет.
Если условия не выполняются, то логируется ошибка, а данные не отправляются.

2 стримлет определяет:
валидны ли бизнес-данные содержащиеся в строках, а именно:
- даты начала подписки не больше текущей даты,
- даты начала подписки не больше даты формирования файла,
- количество дней соответствует разнице между датой начала и датой окончания подписки,
если условия выполняются, то данные отправляются дальше, в противном случае ошибка логируется, а данные не отправляются.

3 стримлет отвечает за накопление и агрегацию данных (Flink).
Агрегировать в список по длительности подписки: до года и более.

4 стримлет отвечает за запись в хранилище (Spark).
Сохраняет полученные списки от 3 стримлета в PostgreSQL.

## Зависимости

* [Scala 2.12.11](https://scala-lang.org)
* [Cloudflow 2.0.25](https://cloudflow.io/)
* [Akka-Stream-Alpakka-File 2.0.2](https://doc.akka.io/docs/alpakka)
* [Akka-Stream-Alpakka-Csv 2.0.2](https://doc.akka.io/docs/alpakka)
* [Doobie 0.9.0](https://tpolecat.github.io/doobie/)
